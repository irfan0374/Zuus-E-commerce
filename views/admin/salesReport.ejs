<%- include('./layout/admin_header.ejs')%>
<section class="content-main">
    <div class="card mb-4">
      <div class="row ml-15">
        <div class="col-lg-6">
          <h1 class="mt-5">Sales Report</h1>
        </div>
        <div class="col-lg-6 text-lg-end">
          <button type="button" onclick="printDiv('printThisDiv')" class="btn btn-primary mt-4">
            Print
          </button>
          <button type="button" onclick="downloadCSV()" class="btn btn-primary mt-4">
            Download CSV
          </button>
        </div>
      </div>
      <div class="row mt-4 ml-15 mb-3">
        <div class="col-lg-4">
          <div class="form-group">
            <label for="startDatePicker">Select start date:</label>
            <input type="date" id="startDatePicker" class="form-control" onchange="selectedDate()" />
          </div>
        </div>
        <div class="col-lg-4">
          <div class="form-group">
            <label for="endDatePicker">Select end date:</label>
            <input type="date" id="endDatePicker" class="form-control" onchange="selectedDate()" />
          </div>
        </div>
      </div>
      <div id="dateError" class="text-danger ml-15 mb-3" style="display: none;">End date should be after start date.</div>
      <!-- card-header end// -->
      <div class="card-body">
        <div class="table-responsive">
          <div id="printThisDiv">
            <table class="table table-hover table-bordered" id="tableReport">
              <thead id="tablehead">
                <tr>
                  <th>No</th>
                  <th scope="col">Id</th>
                  <th scope="col">Product</th>
                  <th scope="col">Price</th>
                  <th scope="col">Quantity</th>
                  <th scope="col">Payment Method</th>
                  <th scope="col">Total</th>
                  <th scope="col">Date</th>
                </tr>
              </thead>
              <tbody>
                <%let count=1%>
                <% order.forEach(order=>{
                    order.products.forEach(product=>{%>
                    <tr>
                        <td>
                            <%=count %>
                        </td>
                        <td><b>
                            <%=order._id%>
                        </b>

                        </td>
                        <td>
                            <%=product.productId.name%>
                        </td>
                        <td>
                            <%=product.productId.price%>

                        </td>
                        <td>
                            <%=product.quantity%>

                        </td>
                        <td>
                            <%=order.payment%>
                        </td>
                        <td>
                            <%=product.productId.price*product.quantity%>
                        </td>
                        <td>
                            <%= moment(order.date).format('MM/DD/YYYY') %>
                          </td>
                      
                    </tr>
                    <%count++%>
                    <%})%>
                    <%})%>
              </tbody>
            </table>
          </div>
        </div>
        <!-- table-responsive //end -->
      </div>
      <!-- card-body end// -->
    </div>
    <!-- card end// --> 
    <!-- Pagination section goes here -->
  </section>
  <%- include('./layout/admin_footer.ejs')%>
  <script>
    function printDiv(divName) {
   
    const printContents = document.getElementById(divName).innerHTML;
    const originalContents = document.body.innerHTML;
    document.body.innerHTML = printContents;
    window.print();
    document.body.innerHTML = originalContents;
  }

  </script>
  